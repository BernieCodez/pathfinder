
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pathfinder</title>
    <link id="theme-link" rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="grid-container" id="myGrid">
    <script>
        //ANIMATIONS FOR THE GRID//
        function fadeIn(element, duration) {
            element.style.opacity = 0;
            element.style.display = "block";
            let startTime = null;

            function animation(currentTime) {
                if (!startTime) {
                startTime = currentTime;
                }

                const timeElapsed = currentTime - startTime;
                const progress = Math.min(timeElapsed / duration, 1); 
                element.style.opacity = progress;

                if (timeElapsed < duration) {
                requestAnimationFrame(animation);
                }
            }
            requestAnimationFrame(animation);
        }
        //ANIMATIONS FOR THE GRID//

        //random setup required variables
        let size = 5;
        let gameEnd = false;
        const gridContainer = document.getElementById('myGrid');
        document.documentElement.style.setProperty("--columns",size);
        document.documentElement.style.setProperty("--rows",size+2);

        


        //MAP GEN//
        //digital map setup
        let counter=0;
        let grid=[];
        let line = [];
        //let standable=[];
        let extra = [];
        for(let c=0;c <size; c++){
            extra.push('-');
            //standable.push([0,c]);
            //standable.push([size+1,c]);
        }
        //console.log(standable);
        grid.push(extra);
        for (let r=0; r < size; r++){
            for(let c=0; c< size; c++){
                line.push('*');
            }
            grid.push(line);
            line=[];
        }
        grid.push(extra);


        


        function build(coord, rand){
            //So effececient I'm so good :D
            let directions = {
                0 : [-1,0],
                1 : [-1,0],
                2 : [0,1],
                3 : [0,-1]
            };
            let newCoord = [coord[0] + directions[rand][0], coord[1] + directions[rand][1]];
 
            if(newCoord[0] >= 0 || newCoord[0] <= size-1 || newCoord[1] >= 0 || newCoord[1] <= size-1){
                if(grid[newCoord[0]][newCoord[1]] == '*'){
                    grid[newCoord[0]][newCoord[1]] = String.fromCharCode(counter+48);
                    counter++;

                    return newCoord;
                }
                
            }
            return coord;
            
        }

        //actual map gen
        //start by generating start loc
        let rand = Math.floor(Math.random() * 5);
        let coord = [size, rand];
        grid[coord[0]][coord[1]] = String.fromCharCode(counter+48);
        counter++;

        while(true){
            rand = Math.floor(Math.random()*4);
            //randomly builds in the randomly selected direction 
            coord = build(coord, rand);

            if(coord[0] == 1){
                break;
            }
        }



        console.log(grid);

        //GRID CREATION//
        //with animation!


        let r=0;
        let c=0;
        function createSquare(i=0){
            const gridItem = document.createElement('div');
            
            gridItem.id = `${r} ${c}`;//give it id that matches with the digitl grid.
            gridItem.classList.add('grid-item');
            
            if(r == 0 || r== size+1){
                gridItem.classList.add("safe");
                // gridItem.style.borderColor = "white";
                // gridItem.style.boxShadow = "0px 0px 5px white";
            }else{
                console.log("Nope")
            }

            gridContainer.appendChild(gridItem);
            fadeIn(gridItem, 1000);
            c++;
            if(c%size==0){
                c=0;
                r++;
            }

            if(i==size*size+(size)*2-1){
                return;
            }
            i++;
            setTimeout(() => createSquare(i), 100);
        }
        createSquare();
        
        //GRID CREATION//

        //UPDATES BOTH GRIDS//
        //starting position of the player
        let playerCoords = [size+1, 0];
        let count = -1;
        function onPath(){
            if(playerCoords[0] == 0){
                console.log("You won!");
                gameEnd = true;
            }
            if (grid[playerCoords[0]][playerCoords[1]] != '-'){
                count++;

                if(grid[playerCoords[0]][playerCoords[1]] != count ){
                    //oopsie stepped on the wrong thing!
                    setTimeout(() =>restart(), 200);
                }
            }
        }
        function restart(){
            let square = document.getElementById(`${playerCoords[0]} ${playerCoords[1]}`);
            square.textContent = "";
            // square.style.borderColor = "rgb(155, 155, 155)";
            // square.style.boxShadow = "none";
            square.classList.remove('stand');
            playerCoords = [size+1, 0];
            updateGrid(0,0);
            count= -1;
        }
        function updateGrid(r,c){
            if(gameEnd == false){
                //if (0<=playerCoords[0]+r<grid.length && 0<=playerCoords[1]+c<=size){
                let next = [playerCoords[0]+r,playerCoords[1]+c];
                let current = [playerCoords[0],playerCoords[1]];
                let square = document.getElementById(`${next[0]} ${next[1]}`);
                let prevSquare = document.getElementById(`${current[0]} ${current[1]}`);
                try{
                    //grid[playerCoords[0]+r][playerCoords[1]+c] = 'O'; 
                    //grid[playerCoords[0]][playerCoords[1]] = '*'; //reset to void after walked on
                    
                    prevSquare.textContent = "";
                    square.textContent = "O";

                    // prevSquare.style.borderColor = "rgb(155, 155, 155)";
                    // square.style.borderColor = "white";
                    // prevSquare.style.boxShadow = "none";
                    // square.style.boxShadow = "0px 0px 5px white";
                    prevSquare.classList.remove('stand');
                    square.classList.add("stand");


                    playerCoords = [next[0], next[1]];
                    //console.log(grid);

                    //checks if the player is on the path
                    onPath();
                    // setTimeout(() =>onPath(), 200);
                    
                } catch{
                    prevSquare.textContent = "O";
                    console.log("You can't leave the grid!");
                }
            }
            

            
        }

        setTimeout(() =>updateGrid(0,0), 150*size*(size+2));

        

        //UPDATES BOTH GRIDS//


        //PLAYER MOVEMENT//
       
        //finished he he
        const pressedKeys = {};

        document.addEventListener('keydown', (event) => {
        if (!pressedKeys[event.key]) {
            pressedKeys[event.key] = true;
                switch (event.key) {
                        case 'w': // Move up
                        updateGrid(-1,0)
                        break;
                        case 's': // Move down
                        updateGrid(1,0)
                        break;
                        case 'a': // Move left
                        updateGrid(0,-1)
                        break;
                        case 'd': // Move right
                        updateGrid(0,1)
                        break;
                    }
            
            
        }
        });

        document.addEventListener('keyup', (event) => {
        delete pressedKeys[event.key];
        });
        //PLAYER MOVEMENT//


</script>
        
    </script>
  </body>
</html>
